#include "led.h"
#include "usart.h"
#include "gpio.h"
#include<stdio.h>
#include<string.h>
//int main()
//{
//	led2_init();
//	usart_init();
//
//	while(1)
//	{
//		gpio_init();
//		led2_on();
//		for(int i=0;i<900000;i++){}
//		led2_off();
//		for(int i=0;i<900000;i++){}
//		uint8_t data[50];
//		uint8_t length = 10;
//		usart_receive_bytes(data,length);
//		usart_send_bytes(data,length);
//		if(data == 'h')
//		{
//			led2_on();
//			for(int i=0;i<900000;i++){}
//		}
//		else
//		{
//			led2_off();
//			for(int i=0;i<900000;i++){}
//		}
//		uint8_t payLoad[100];
//		memset(payLoad,0,sizeof(payLoad));
//		sprintf(payLoad,"Hi, Hello world %d !\r\n",20);
//		//uint8_t payLoad[] = "Hi, Hello world" +20+"!\r\n";
//		usart_send_bytes(payLoad,sizeof(payLoad));
//		printf("Hello from STM32F4.........\n\r");
//	}
//}


//int main()
//{
//	gpio_init();
//	led2_init();
//	usart_init();
//	uint8_t payLoad[100];
//	while(1)
//	{
//	  if ( isButtonPressed() == 0 )
//	  {
//		  sprintf(payLoad,"BL_DEBUG_MSG:Button is pressed .. going to BL mode\n\r") ;
//		  usart_send_bytes(payLoad,sizeof(payLoad));
//		  //we should continue in bootloader mode
//		  bootloader_uart_read_data();
//
//	  }
//	  else
//	  {
//		  sprintf(payLoad,"BL_DEBUG_MSG:Button is not pressed .. executing user app\n" );
//		  usart_send_bytes(payLoad,sizeof(payLoad));
//			//jump to user application
//			bootloader_jump_to_user_app();
//
//	  }
//	}
//}

//Testing crc

int main()
{
	led2_init();
	usart_init();
	crc_init();
	while(1)
	{
		uint32_t data[10];
		data[0]= 52;
		uint32_t crc = caluculate_crc(data,1);
		if(crc==0x2B3F81C9)
		{
			led2_on();
		}
		else
		{
			led2_off();
			uint8_t crc2[4] =crc;
			usart_send_bytes(&crc2,sizeof(crc2));
		}
	}
}
